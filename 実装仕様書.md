# 画像リサイズツール 実装仕様書

## 1. プロジェクト概要

### 1.1 プロジェクト名

画像リサイズツール (Image Resizer Tool)

### 1.2 プロジェクトの目的

フォルダ内の画像ファイルを一括で指定された解像度にリサイズし、ファイル名に"\_red"を追加して保存する GUI アプリケーション

### 1.3 開発環境

- **言語**: Python 3.7 以上
- **GUI フレームワーク**: tkinter (標準ライブラリ)
- **画像処理ライブラリ**: Pillow 10.0.0 以上
- **OS 対応**: Windows 10/11 (PowerShell 対応)

## 2. システム構成

### 2.1 ファイル構成

```
resize/
├── image_resizer.py      # メインアプリケーション
├── requirements.txt      # 依存関係定義
├── README.md            # 使用方法説明書
├── run.bat              # Windows起動スクリプト
└── 実装仕様書.md        # 本仕様書
```

### 2.2 アーキテクチャ

- **MVC パターン**: GUI (View) とビジネスロジック (Model) の分離
- **単一責任原則**: 各メソッドが特定の機能に特化
- **エラーハンドリング**: 包括的な例外処理

## 3. 機能仕様

### 3.1 主要機能

#### 3.1.1 画像ファイル検出機能

- **対応形式**: JPG, JPEG, PNG, BMP, GIF, TIFF, WebP
- **検索方法**: 大文字・小文字の拡張子に対応
- **検索範囲**: 指定フォルダ内の全画像ファイル

#### 3.1.2 リサイズ機能

- **リサイズ方法**:
  - アスペクト比保持: `thumbnail()`メソッド使用
  - アスペクト比無視: `resize()`メソッド使用
- **リサンプリング**: LANCZOS (高品質)
- **保存品質**: 95% (JPEG 最適化有効)

#### 3.1.3 ファイル名変更機能

- **命名規則**: `{元ファイル名}_red.{拡張子}`
- **例**: `MedinetHubLow.1001.jpg` → `MedinetHubLow.1001_red.jpg`

### 3.2 GUI 機能

#### 3.2.1 フォルダ選択

- **入力方法**: テキスト入力 + フォルダ選択ダイアログ
- **初期値**: 現在の作業ディレクトリ
- **検証**: フォルダ存在チェック

#### 3.2.2 解像度設定

- **幅**: デフォルト値 1024px
- **高さ**: デフォルト値 1024px
- **入力制限**: 正の整数のみ
- **検証**: 値の妥当性チェック

#### 3.2.3 アスペクト比設定

- **デフォルト**: 保持する (チェック済み)
- **動作**:
  - チェック時: 指定サイズ内で最大サイズに調整
  - 未チェック時: 指定サイズに強制リサイズ

#### 3.2.4 進捗表示

- **進捗バー**: 処理状況の視覚的表示
- **ログ表示**: 詳細な処理ログ
- **完了通知**: 処理結果のポップアップ表示

## 4. 技術仕様

### 4.1 クラス設計

#### 4.1.1 ImageResizer クラス

```python
class ImageResizer:
    def __init__(self, root)
    def setup_ui(self)
    def select_folder(self)
    def log_message(self, message)
    def get_image_files(self, folder_path)
    def resize_images(self)
    def clear_all(self)
```

#### 4.1.2 主要メソッド詳細

**setup_ui()**

- GUI レイアウトの構築
- グリッドレイアウトマネージャー使用
- レスポンシブデザイン対応

**get_image_files(folder_path)**

- glob パターンマッチング
- 複数拡張子対応
- ソート済みリスト返却

**resize_images()**

- バッチ処理実装
- 進捗管理
- エラーハンドリング
- メモリ効率的な画像処理

### 4.2 データフロー

1. **入力検証** → フォルダ存在チェック
2. **ファイル検索** → 画像ファイル一覧取得
3. **設定検証** → 解像度値の妥当性チェック
4. **バッチ処理** → 各画像のリサイズ処理
5. **進捗更新** → リアルタイム進捗表示
6. **結果報告** → 処理完了通知

### 4.3 エラーハンドリング

#### 4.3.1 入力エラー

- 無効なフォルダパス
- 不正な解像度値
- 画像ファイル未発見

#### 4.3.2 処理エラー

- 画像読み込み失敗
- ファイル保存失敗
- メモリ不足

#### 4.3.3 エラー対応

- ユーザーフレンドリーなエラーメッセージ
- 処理継続（エラー個別処理）
- 詳細ログ出力

## 5. パフォーマンス仕様

### 5.1 処理性能

- **メモリ使用**: 画像を 1 つずつ処理（メモリ効率化）
- **処理速度**: 画像サイズに依存（LANCZOS リサンプリング）
- **同時処理**: シングルスレッド（UI 応答性重視）

### 5.2 UI 応答性

- **非ブロッキング**: 処理中の UI 更新
- **進捗表示**: リアルタイム進捗バー更新
- **キャンセル機能**: 未実装（将来拡張可能）

## 6. セキュリティ仕様

### 6.1 ファイル操作

- **読み取り専用**: 元ファイルは変更しない
- **上書き確認**: 同名ファイルの上書き警告なし
- **パス検証**: ディレクトリトラバーサル対策

### 6.2 入力検証

- **数値検証**: 解像度値の範囲チェック
- **パス検証**: フォルダ存在確認
- **拡張子検証**: 安全なファイル形式のみ処理

## 7. 保守性・拡張性

### 7.1 コード品質

- **コメント**: 日本語コメント充実
- **命名規則**: 分かりやすい変数・メソッド名
- **構造化**: 機能別メソッド分割

### 7.2 拡張可能性

- **新形式対応**: 画像形式追加が容易
- **設定保存**: 設定値の永続化（未実装）
- **バッチ処理**: 複数フォルダ処理（未実装）

## 8. テスト仕様

### 8.1 単体テスト

- **入力検証テスト**: 各種入力値の妥当性チェック
- **ファイル処理テスト**: 画像ファイルの読み書きテスト
- **エラーハンドリングテスト**: 例外処理の動作確認

### 8.2 統合テスト

- **GUI 操作テスト**: 全機能の動作確認
- **パフォーマンステスト**: 大量ファイル処理テスト
- **クロスプラットフォームテスト**: Windows 環境での動作確認

## 9. デプロイメント仕様

### 9.1 依存関係

```
Pillow>=10.0.0
```

### 9.2 実行環境

- **Python**: 3.7 以上
- **OS**: Windows 10/11
- **メモリ**: 最低 512MB 推奨
- **ディスク**: 処理対象画像の 2 倍以上の空き容量

### 9.3 インストール手順

1. Python 環境確認
2. 依存関係インストール: `pip install -r requirements.txt`
3. アプリケーション起動: `python image_resizer.py`

## 10. 制約事項

### 10.1 技術的制約

- **シングルスレッド**: 処理中の UI 応答性制限
- **メモリ制限**: 大容量画像の同時処理不可
- **ファイル形式**: 特定の画像形式のみ対応

### 10.2 運用制約

- **Windows 専用**: 他の OS での動作未確認
- **管理者権限**: 特定フォルダへのアクセス制限
- **ネットワーク**: ローカルファイルのみ対応

## 11. 将来拡張計画

### 11.1 短期拡張

- 設定値の永続化
- 処理キャンセル機能
- 出力フォルダ指定機能

### 11.2 中期拡張

- 複数フォルダ一括処理
- 画像形式変換機能
- バッチファイル対応

### 11.3 長期拡張

- マルチスレッド処理
- クラウドストレージ対応
- Web アプリケーション化
